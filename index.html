<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ™ï¸ æ—¥è¯­å¯¹è¯æ’­å®¢ç”Ÿæˆå™¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .dialogue-a { background: linear-gradient(90deg, #fef3c7, #fbbf24); }
        .dialogue-b { background: linear-gradient(90deg, #dbeafe, #3b82f6); }
        .audio-segment { transition: all 0.3s ease; }
        .audio-segment:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0,0,0,0.15); }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-50 to-blue-50 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- å¤´éƒ¨ -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold bg-gradient-to-r from-purple-600 to-blue-600 bg-clip-text text-transparent mb-2">
                ğŸ™ï¸ æ—¥è¯­å¯¹è¯æ’­å®¢ç”Ÿæˆå™¨
            </h1>
            <p class="text-gray-600">å°†ä»»ä½•å†…å®¹è½¬æ¢ä¸ºè‡ªç„¶çš„æ—¥è¯­åŒäººå¯¹è¯æ’­å®¢</p>
            <div class="mt-4 flex justify-center space-x-4 text-sm text-gray-500">
                <span class="flex items-center"><i class="fas fa-female text-pink-500 mr-1"></i> ä¸»æŒäººA (å¥³æ€§)</span>
                <span class="flex items-center"><i class="fas fa-male text-blue-500 mr-1"></i> ä¸»æŒäººB (ç”·æ€§)</span>
                <span class="flex items-center"><i class="fas fa-comments text-green-500 mr-1"></i> ä¸€é—®ä¸€ç­”å¯¹è¯</span>
            </div>
        </div>

        <div class="grid lg:grid-cols-2 gap-8">
            <!-- è¾“å…¥åŒºåŸŸ -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-xl font-semibold mb-4 flex items-center">
                    <i class="fas fa-edit text-blue-500 mr-2"></i>
                    å†…å®¹è¾“å…¥
                </h2>
                
                <!-- é€‰é¡¹å¡ -->
                <div class="flex mb-4 bg-gray-100 rounded-lg p-1">
                    <button id="textTab" class="tab-button active flex-1 py-2 px-4 rounded-md transition-all duration-200 font-medium">
                        <i class="fas fa-keyboard mr-2"></i>æ–‡æœ¬è¾“å…¥
                    </button>
                    <button id="urlTab" class="tab-button flex-1 py-2 px-4 rounded-md transition-all duration-200 font-medium">
                        <i class="fas fa-globe mr-2"></i>URLè¾“å…¥
                    </button>
                </div>

                <!-- æ–‡æœ¬è¾“å…¥æ ‡ç­¾é¡µ -->
                <div id="textInput" class="tab-content">
                    <textarea id="content" rows="10" placeholder="è¾“å…¥ä½ æƒ³è½¬æ¢ä¸ºæ—¥è¯­å¯¹è¯æ’­å®¢çš„å†…å®¹..." 
                              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"></textarea>
                    
                    <div class="mt-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">å¯¹è¯é£æ ¼</label>
                        <select id="style" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <option value="educational">æ•™è‚²æ€§ - é€‚åˆå­¦ä¹ å†…å®¹</option>
                            <option value="conversational">å¯¹è¯æ€§ - è½»æ¾èŠå¤©é£æ ¼</option>
                            <option value="interview">è®¿è°ˆå‹ - é—®ç­”äº’åŠ¨é£æ ¼</option>
                            <option value="narrative">å™è¿°å‹ - æ•…äº‹è®²è¿°é£æ ¼</option>
                        </select>
                    </div>
                </div>

                <!-- URLè¾“å…¥æ ‡ç­¾é¡µ -->
                <div id="urlInput" class="tab-content hidden">
                    <input type="url" id="url" placeholder="è¾“å…¥ç½‘é¡µURL..." 
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent mb-4">
                    <button id="scrapeBtn" class="w-full bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded-lg transition-colors duration-200">
                        <i class="fas fa-download mr-2"></i>æŠ“å–å†…å®¹
                    </button>
                    <div class="mt-2 text-xs text-gray-500">
                        æ”¯æŒåšå®¢ã€æ–°é—»ã€æ–‡ç« ç­‰ç½‘é¡µå†…å®¹æŠ“å–
                    </div>
                </div>

                <button id="generateBtn" class="w-full bg-gradient-to-r from-purple-500 to-blue-500 hover:from-purple-600 hover:to-blue-600 text-white py-3 px-6 rounded-lg font-semibold mt-6 transition-all duration-200 shadow-lg">
                    <i class="fas fa-magic mr-2"></i>ç”Ÿæˆå¯¹è¯æ’­å®¢
                </button>
                
                <!-- çŠ¶æ€è¯´æ˜ -->
                <div class="mt-4 text-xs text-gray-500 text-center">
                    <i class="fas fa-shield-alt mr-1"></i>
                    APIå¯†é’¥å·²å®‰å…¨é…ç½®åœ¨æœåŠ¡å™¨ç«¯ï¼Œæ— éœ€æ‰‹åŠ¨è¾“å…¥
                </div>
            </div>

            <!-- ç»“æœæ˜¾ç¤ºåŒºåŸŸ -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-xl font-semibold mb-4 flex items-center">
                    <i class="fas fa-podcast text-purple-500 mr-2"></i>
                    æ’­å®¢ç»“æœ
                </h2>
                
                <!-- åŠ è½½çŠ¶æ€ -->
                <div id="loading" class="hidden text-center py-12">
                    <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-purple-500 mb-4"></div>
                    <p class="text-gray-600">æ­£åœ¨ç”Ÿæˆå¯¹è¯æ’­å®¢...</p>
                    <p class="text-sm text-gray-500 mt-2">AIæ­£åœ¨åˆ›å»ºåŒäººå¯¹è¯è„šæœ¬å¹¶ç”Ÿæˆè¯­éŸ³</p>
                </div>

                <!-- é”™è¯¯æ˜¾ç¤º -->
                <div id="error" class="hidden bg-red-50 border border-red-200 rounded-lg p-4 mb-4">
                    <p class="text-red-600 font-medium">ç”Ÿæˆå¤±è´¥</p>
                    <p id="errorMessage" class="text-red-500 text-sm mt-1"></p>
                </div>

                <!-- æˆåŠŸç»“æœ -->
                <div id="result" class="hidden">
                    <!-- æ’­å®¢ä¿¡æ¯ -->
                    <div class="bg-gradient-to-r from-purple-100 to-blue-100 rounded-lg p-4 mb-6">
                        <div class="grid grid-cols-2 gap-4 text-center">
                            <div>
                                <div class="text-2xl font-bold text-purple-600" id="wordCount">0</div>
                                <div class="text-sm text-gray-600">æ€»å­—æ•°</div>
                            </div>
                            <div>
                                <div class="text-2xl font-bold text-blue-600" id="duration">0</div>
                                <div class="text-sm text-gray-600">é¢„ä¼°æ—¶é•¿(åˆ†é’Ÿ)</div>
                            </div>
                        </div>
                        <div class="mt-3 text-center">
                            <div class="text-lg font-semibold text-gray-700" id="segmentInfo">å¯¹è¯ç‰‡æ®µæ•°ï¼š0</div>
                        </div>
                    </div>

                    <!-- éŸ³é¢‘æ’­æ”¾å™¨åŒºåŸŸ -->
                    <div id="audioSection" class="mb-6">
                        <h3 class="text-lg font-semibold mb-3 flex items-center">
                            <i class="fas fa-headphones text-green-500 mr-2"></i>
                            å¯¹è¯éŸ³é¢‘
                        </h3>
                        <div id="audioSegments" class="space-y-3">
                            <!-- éŸ³é¢‘ç‰‡æ®µå°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>

                    <!-- å¯¹è¯è„šæœ¬æ˜¾ç¤º -->
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold mb-3 flex items-center">
                            <i class="fas fa-scroll text-orange-500 mr-2"></i>
                            å¯¹è¯è„šæœ¬
                        </h3>
                        <div id="dialogueScript" class="space-y-2 max-h-96 overflow-y-auto border rounded-lg p-4">
                            <!-- å¯¹è¯å†…å®¹å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                        </div>
                    </div>

                    <!-- å®Œæ•´è„šæœ¬ -->
                    <div>
                        <h3 class="text-lg font-semibold mb-3 flex items-center">
                            <i class="fas fa-file-text text-gray-500 mr-2"></i>
                            å®Œæ•´è„šæœ¬
                            <button id="copyScript" class="ml-2 text-sm bg-gray-100 hover:bg-gray-200 px-2 py-1 rounded transition-colors">
                                <i class="fas fa-copy"></i> å¤åˆ¶
                            </button>
                        </h3>
                        <div id="fullScript" class="bg-gray-50 rounded-lg p-4 text-sm max-h-48 overflow-y-auto border font-mono"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // DOMå…ƒç´ 
        const textTab = document.getElementById('textTab');
        const urlTab = document.getElementById('urlTab');
        const textInput = document.getElementById('textInput');
        const urlInput = document.getElementById('urlInput');
        const generateBtn = document.getElementById('generateBtn');
        const scrapeBtn = document.getElementById('scrapeBtn');
        const loading = document.getElementById('loading');
        const error = document.getElementById('error');
        const result = document.getElementById('result');

        // æ ‡ç­¾é¡µåˆ‡æ¢
        textTab.addEventListener('click', () => switchTab('text'));
        urlTab.addEventListener('click', () => switchTab('url'));

        function switchTab(tab) {
            if (tab === 'text') {
                textTab.classList.add('active', 'bg-white', 'text-blue-600', 'shadow-sm');
                textTab.classList.remove('text-gray-600');
                urlTab.classList.remove('active', 'bg-white', 'text-blue-600', 'shadow-sm');
                urlTab.classList.add('text-gray-600');
                textInput.classList.remove('hidden');
                urlInput.classList.add('hidden');
            } else {
                urlTab.classList.add('active', 'bg-white', 'text-blue-600', 'shadow-sm');
                urlTab.classList.remove('text-gray-600');
                textTab.classList.remove('active', 'bg-white', 'text-blue-600', 'shadow-sm');
                textTab.classList.add('text-gray-600');
                urlInput.classList.remove('hidden');
                textInput.classList.add('hidden');
            }
        }

        // æŠ“å–ç½‘é¡µå†…å®¹
        scrapeBtn.addEventListener('click', async () => {
            const url = document.getElementById('url').value.trim();
            if (!url) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„URL');
                return;
            }

            scrapeBtn.disabled = true;
            scrapeBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>æŠ“å–ä¸­...';

            try {
                const response = await fetch('/api/scrape', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ url })
                });

                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('content').value = data.content;
                    switchTab('text');
                    alert('ç½‘é¡µå†…å®¹æŠ“å–æˆåŠŸï¼');
                } else {
                    alert('æŠ“å–å¤±è´¥: ' + data.error);
                }
            } catch (err) {
                alert('æŠ“å–å¤±è´¥: ' + err.message);
            } finally {
                scrapeBtn.disabled = false;
                scrapeBtn.innerHTML = '<i class="fas fa-download mr-2"></i>æŠ“å–å†…å®¹';
            }
        });

        // ç”Ÿæˆæ’­å®¢
        generateBtn.addEventListener('click', async () => {
            const content = document.getElementById('content').value.trim();
            const style = document.getElementById('style').value;

            if (!content) {
                alert('è¯·è¾“å…¥å†…å®¹');
                return;
            }

            if (content.length < 100) {
                alert('å†…å®¹å¤ªçŸ­ï¼Œè¯·è¾“å…¥è‡³å°‘100å­—ç¬¦çš„å†…å®¹');
                return;
            }

            // éšè—ä¹‹å‰çš„ç»“æœ
            hideAllSections();
            loading.classList.remove('hidden');
            generateBtn.disabled = true;
            generateBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>ç”Ÿæˆä¸­...';

            try {
                const response = await fetch('/api/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        content,
                        style,
                        voice: 'dialogue'
                    })
                });

                const data = await response.json();

                if (data.success) {
                    displayDialogueResult(data);
                } else {
                    showError(data.error || 'ç”Ÿæˆå¤±è´¥');
                }
            } catch (err) {
                showError('è¯·æ±‚å¤±è´¥: ' + err.message);
            } finally {
                loading.classList.add('hidden');
                generateBtn.disabled = false;
                generateBtn.innerHTML = '<i class="fas fa-magic mr-2"></i>ç”Ÿæˆå¯¹è¯æ’­å®¢';
            }
        });

        // æ˜¾ç¤ºå¯¹è¯æ’­å®¢ç»“æœ
        function displayDialogueResult(data) {
            document.getElementById('wordCount').textContent = data.wordCount || 0;
            document.getElementById('duration').textContent = data.duration || 0;
            document.getElementById('segmentInfo').textContent = 
                'å¯¹è¯ç‰‡æ®µæ•°ï¼š' + (data.totalSegments || 0) + ' | å·²ç”ŸæˆéŸ³é¢‘ï¼š' + (data.processedSegments || 0);

            displayAudioSegments(data.audioSegments || []);
            displayDialogueScript(data.dialogueParts || []);
            document.getElementById('fullScript').textContent = data.script || '';
            result.classList.remove('hidden');
        }

        // æ˜¾ç¤ºéŸ³é¢‘ç‰‡æ®µ
        function displayAudioSegments(audioSegments) {
            const container = document.getElementById('audioSegments');
            container.innerHTML = '';

            if (audioSegments.length === 0) {
                container.innerHTML = '<div class="text-center py-8 text-gray-500"><i class="fas fa-volume-mute text-4xl mb-2"></i><p>æš‚æ— éŸ³é¢‘ç‰‡æ®µ</p><p class="text-sm">éŸ³é¢‘ç”Ÿæˆå¯èƒ½éœ€è¦æ›´å¤šæ—¶é—´</p></div>';
                return;
            }

            audioSegments.forEach((segment, index) => {
                const speakerInfo = segment.speaker === 'A' ? 
                    { name: 'ä¸»æŒäººA', icon: 'fa-female', color: 'pink', bgColor: 'dialogue-a' } :
                    { name: 'ä¸»æŒäººB', icon: 'fa-male', color: 'blue', bgColor: 'dialogue-b' };

                const segmentHtml = '<div class="audio-segment ' + speakerInfo.bgColor + ' rounded-lg p-4 shadow-sm">' +
                    '<div class="flex items-center justify-between mb-2">' +
                    '<span class="font-semibold text-gray-700 flex items-center">' +
                    '<i class="fas ' + speakerInfo.icon + ' text-' + speakerInfo.color + '-500 mr-2"></i>' +
                    speakerInfo.name + ' - ç‰‡æ®µ ' + (index + 1) +
                    '</span>' +
                    '<span class="text-xs text-gray-500">ç¬¬' + (segment.order + 1) + 'æ®µ</span>' +
                    '</div>' +
                    '<p class="text-sm text-gray-600 mb-3">' + segment.text.substring(0, 100) + (segment.text.length > 100 ? '...' : '') + '</p>' +
                    '<audio controls class="w-full">' +
                    '<source src="' + segment.audioUrl + '" type="audio/mpeg">' +
                    'æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾ã€‚' +
                    '</audio>' +
                    '</div>';
                container.insertAdjacentHTML('beforeend', segmentHtml);
            });
        }

        // æ˜¾ç¤ºå¯¹è¯è„šæœ¬
        function displayDialogueScript(dialogueParts) {
            const container = document.getElementById('dialogueScript');
            container.innerHTML = '';

            if (dialogueParts.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-4">æš‚æ— å¯¹è¯å†…å®¹</p>';
                return;
            }

            dialogueParts.forEach((part, index) => {
                const speakerInfo = part.speaker === 'A' ? 
                    { name: 'ä¸»æŒäººA', icon: 'fa-female', color: 'pink-500', bgClass: 'dialogue-a' } :
                    { name: 'ä¸»æŒäººB', icon: 'fa-male', color: 'blue-500', bgClass: 'dialogue-b' };

                const partHtml = '<div class="' + speakerInfo.bgClass + ' rounded-lg p-3 border-l-4 border-' + speakerInfo.color + '">' +
                    '<div class="font-semibold text-gray-700 mb-1 flex items-center">' +
                    '<i class="fas ' + speakerInfo.icon + ' text-' + speakerInfo.color + ' mr-2"></i>' +
                    speakerInfo.name +
                    '</div>' +
                    '<p class="text-gray-700">' + part.text + '</p>' +
                    '</div>';
                container.insertAdjacentHTML('beforeend', partHtml);
            });
        }

        // å¤åˆ¶è„šæœ¬åŠŸèƒ½
        document.getElementById('copyScript').addEventListener('click', () => {
            const script = document.getElementById('fullScript').textContent;
            navigator.clipboard.writeText(script).then(() => {
                const btn = document.getElementById('copyScript');
                const originalText = btn.innerHTML;
                btn.innerHTML = '<i class="fas fa-check"></i> å·²å¤åˆ¶';
                setTimeout(() => {
                    btn.innerHTML = originalText;
                }, 2000);
            });
        });

        // è¾…åŠ©å‡½æ•°
        function hideAllSections() {
            loading.classList.add('hidden');
            error.classList.add('hidden');
            result.classList.add('hidden');
        }

        function showError(message) {
            error.classList.remove('hidden');
            document.getElementById('errorMessage').textContent = message;
        }

        // æ ·å¼
        const style = document.createElement('style');
        style.textContent = '.tab-button.active { background: white; color: #2563eb; box-shadow: 0 1px 3px rgba(0,0,0,0.1); } .line-clamp-2 { display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }';
        document.head.appendChild(style);
    </script>
</body>
</html>
