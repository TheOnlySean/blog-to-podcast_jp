<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VoiceId ä¿®å¤éªŒè¯</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; max-width: 800px; }
        .result { background: #f0f0f0; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        button { padding: 12px 24px; margin: 10px 5px; cursor: pointer; background: #007bff; color: white; border: none; border-radius: 5px; }
        button:hover { background: #0056b3; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 3px; overflow-x: auto; white-space: pre-wrap; }
        .loading { opacity: 0.7; }
    </style>
</head>
<body>
    <h1>ğŸ”’ VoiceId ä¿®å¤éªŒè¯å·¥å…·</h1>
    
    <div class="info">
        <h3>ğŸ“‹ æµ‹è¯•ç›®æ ‡</h3>
        <p>éªŒè¯ <code>voiceId is not defined</code> é”™è¯¯æ˜¯å¦å·²ä¿®å¤</p>
        <p>æ£€æŸ¥è°ƒè¯•æ—¥å¿—å’Œå®‰å…¨å›é€€æœºåˆ¶</p>
    </div>
    
    <div>
        <h3>ğŸ§ª æµ‹è¯•ç”¨ä¾‹</h3>
        <button onclick="testVoiceId('female', 'educational')">æµ‹è¯•å¥³æ€§è¯­éŸ³</button>
        <button onclick="testVoiceId('male', 'conversational')">æµ‹è¯•ç”·æ€§è¯­éŸ³</button>
        <button onclick="testVoiceId('invalid', 'invalid')">æµ‹è¯•æ— æ•ˆå‚æ•°</button>
        <button onclick="testVoiceId('', '')">æµ‹è¯•ç©ºå‚æ•°</button>
    </div>
    
    <div id="results"></div>

    <script>
        async function testVoiceId(voice, style) {
            const resultsDiv = document.getElementById('results');
            const testId = Date.now();
            
            // æ·»åŠ åŠ è½½çŠ¶æ€
            const loadingHtml = `
                <div id="test-${testId}" class="result info loading">
                    <h4>ğŸ”„ æµ‹è¯•ä¸­: voice="${voice}", style="${style}"</h4>
                    <p>æ­£åœ¨è°ƒç”¨ API...</p>
                </div>
            `;
            resultsDiv.innerHTML = loadingHtml + resultsDiv.innerHTML;
            
            try {
                const testData = {
                    content: `ã“ã‚“ã«ã¡ã¯ã€çš†ã•ã‚“ã€‚ä»Šæ—¥ã¯${voice}éŸ³å£°ã¨${style}ã‚¹ã‚¿ã‚¤ãƒ«ã®ãƒ†ã‚¹ãƒˆã§ã™ã€‚`,
                    style: style || 'educational',
                    voice: voice || 'female',
                    _test_mode: true
                };
                
                console.log('å‘é€æµ‹è¯•è¯·æ±‚:', testData);
                
                const response = await fetch('/api/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(testData)
                });
                
                const data = await response.json();
                
                let resultClass = 'success';
                let statusIcon = 'âœ…';
                let title = 'VoiceId æµ‹è¯•æˆåŠŸï¼';
                
                if (!response.ok || !data.success) {
                    resultClass = 'error';
                    statusIcon = 'âŒ';
                    title = 'VoiceId æµ‹è¯•å¤±è´¥ï¼';
                }
                
                let resultHtml = `
                    <div class="result ${resultClass}">
                        <h4>${statusIcon} ${title} (voice="${voice}", style="${style}")</h4>
                        <p><strong>å“åº”çŠ¶æ€:</strong> ${response.status} ${response.statusText}</p>
                `;
                
                if (data.success) {
                    resultHtml += `
                        <p><strong>âœ… VoiceId çŠ¶æ€:</strong> å·²æ­£ç¡®å®šä¹‰</p>
                        <p><strong>ğŸµ é€‰æ‹©çš„è¯­éŸ³:</strong> ${data.metadata?.voiceId || 'Unknown'}</p>
                        <p><strong>ğŸ“Š è„šæœ¬é•¿åº¦:</strong> ${data.script?.length || 0} å­—ç¬¦</p>
                        <p><strong>ğŸ·ï¸ MCP æ ‡è®°:</strong> ${data.metadata?.mcpBased ? 'æ˜¯' : 'å¦'}</p>
                    `;
                    
                    if (data.metadata?.debugInfo) {
                        resultHtml += `
                            <details>
                                <summary><strong>ğŸ” è°ƒè¯•ä¿¡æ¯</strong></summary>
                                <pre>${JSON.stringify(data.metadata.debugInfo, null, 2)}</pre>
                            </details>
                        `;
                    }
                    
                    if (data.audioUrl) {
                        resultHtml += `<p><strong>ğŸµ éŸ³é¢‘:</strong> <a href="${data.audioUrl}" target="_blank">æ’­æ”¾éŸ³é¢‘</a></p>`;
                    } else if (data.taskId) {
                        resultHtml += `<p><strong>â³ å¼‚æ­¥ä»»åŠ¡:</strong> ${data.taskId}</p>`;
                    }
                } else {
                    resultHtml += `
                        <p><strong>âŒ é”™è¯¯ä¿¡æ¯:</strong> ${data.error || 'æœªçŸ¥é”™è¯¯'}</p>
                        <p><strong>ğŸ“ è¯¦ç»†ä¿¡æ¯:</strong> ${data.details || 'æ— '}</p>
                    `;
                }
                
                resultHtml += `
                        <details>
                            <summary><strong>ğŸ“„ å®Œæ•´å“åº”</strong></summary>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </details>
                    </div>
                `;
                
                document.getElementById(`test-${testId}`).outerHTML = resultHtml;
                
            } catch (error) {
                const errorHtml = `
                    <div class="result error">
                        <h4>ğŸ’¥ ç½‘ç»œé”™è¯¯: voice="${voice}", style="${style}"</h4>
                        <p><strong>é”™è¯¯:</strong> ${error.message}</p>
                        <p><strong>ç±»å‹:</strong> ${error.name}</p>
                    </div>
                `;
                document.getElementById(`test-${testId}`).outerHTML = errorHtml;
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿›è¡Œä¸€æ¬¡åŸºæœ¬æµ‹è¯•
        window.addEventListener('load', () => {
            setTimeout(() => testVoiceId('female', 'educational'), 1000);
        });
    </script>
</body>
</html> 